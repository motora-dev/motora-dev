<!-- Main content -->
@if ((currentPage$ | async); as page) {
<div class="w-full min-h-screen max-w-[90rem] mx-auto lg:grid lg:grid-cols-[16rem_1fr]">
  <!-- Sidebar overlay (mobile only) -->
  @if (isSidebarOpen()) {
  <div class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden" (click)="closeSidebar()" aria-hidden="true"></div>
  }

  <!-- Left sidebar: Page list -->
  <aside
    class="fixed top-16 left-0 h-[calc(100vh-4rem)] w-64 border-r border-gray-200 bg-gray-50 p-6 overflow-y-auto z-50 transition-transform duration-300 ease-in-out lg:sticky lg:top-16 lg:z-0 lg:w-auto"
    [class.-translate-x-full]="!isSidebarOpen()"
    [class.translate-x-0]="isSidebarOpen()"
    [class.lg:translate-x-0]="true"
  >
    <nav>
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-sm font-semibold text-gray-900">目次</h2>
        <button
          (click)="closeSidebar()"
          class="lg:hidden p-1 rounded hover:bg-gray-200 transition-colors"
          aria-label="閉じる"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <ul class="space-y-2">
        @for (p of pages$ | async; track p.id) {
        <li [class]="getIndentClass(p)">
          <a
            [routerLink]="['/article', articleId(), p.id]"
            class="block text-sm py-1 px-2 rounded transition-colors"
            [class.bg-blue-100]="isCurrentPage(p)"
            [class.text-blue-700]="isCurrentPage(p)"
            [class.font-medium]="isCurrentPage(p)"
            [class.text-gray-700]="!isCurrentPage(p)"
            [class.hover:bg-gray-100]="!isCurrentPage(p)"
            [class.hover:text-gray-900]="!isCurrentPage(p)"
            (click)="closeSidebar()"
          >
            {{ p.title }}
          </a>
        </li>
        }
      </ul>
    </nav>
  </aside>

  <!-- Main content -->
  <main class="min-w-0 pb-16">
    <article class="w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-12 py-8 lg:py-12">
      <h1 class="text-3xl md:text-4xl font-bold mb-6 md:mb-8 text-gray-900">{{ page.title }}</h1>
      <div class="w-full prose prose-base max-w-none break-words overflow-hidden" [innerHTML]="safeHtml$ | async"></div>
    </article>

    <!-- Page navigation -->
    @if ((navigation$ | async); as nav) {
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-12 py-6">
      <div class="flex justify-between items-center gap-4">
        @if (nav.prev) {
        <a
          [routerLink]="['/article', articleId(), nav.prev.id]"
          class="flex-1 max-w-[45%] p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left"
        >
          <div class="text-sm text-gray-500 mb-1">← 前へ</div>
          <div class="text-sm font-medium text-gray-900 truncate">{{ nav.prev.title }}</div>
        </a>
        } @else {
        <div class="flex-1"></div>
        } @if (nav.next) {
        <a
          [routerLink]="['/article', articleId(), nav.next.id]"
          class="flex-1 max-w-[45%] p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-right"
        >
          <div class="text-sm text-gray-500 mb-1">次へ →</div>
          <div class="text-sm font-medium text-gray-900 truncate">{{ nav.next.title }}</div>
        </a>
        } @else {
        <div class="flex-1"></div>
        }
      </div>
    </div>
    }
  </main>
</div>
}
